#define GESTURE_COUNT 9
#define AXIS_COUNT 3
#define GESTURE_SIGNATURE_MAXIMUM_SIZE 35
#define GESTURE_CANDIDATE_SIZE 35 // The number of most recent live data points to store

int classifiedGestureIndex = 0;
int previousClassifiedGestureIndex = -1;
unsigned long lastGestureClassificationTime = 0L; // Time of last gesture classification

char* gestureName[GESTURE_COUNT] = {
	"at rest",
	"swing",
	"tap to another, as left",
	"tap to another, as right",
	"shake",
	"tilt left",
	"tilt right",
	"tilt forward",
	"tilt backward"
};

int gestureSignatureSize[] = { 35, 35, 35, 35, 35, 35, 35, 35, 35 };

int gestureSustainDuration[GESTURE_COUNT] = {
	0, // "at rest"
	600, // "swing"
	800, // "tap to another, as left"
	800,  // "tap to another, as right"
	200, // "shake"
	100, // "tilt left"
	100, // "tilt right"
	100, // "tilt forward"
	100 // "tilt backward"
};

int gestureTransitions[GESTURE_COUNT][GESTURE_COUNT] = {
	{ 0, 1, 5, 6, 7, 8, 2, 3, -1 },
	{ 0, 4, 5, 6, 7, 8, 2, 3, -1 },
	{ 0, -1, -1, -1, -1, -1, -1, -1, -1 },
	{ 0, -1, -1, -1, -1, -1, -1, -1, -1 },
	{ 4, 0, -1, -1, -1, -1, -1, -1, -1 },
	{ 5, 0, -1, -1, -1, -1, -1, -1, -1 },
	{ 6, 0, -1, -1, -1, -1, -1, -1, -1 },
	{ 7, 0, -1, -1, -1, -1, -1, -1, -1 },
	{ 8, 0, -1, -1, -1, -1, -1, -1, -1 }
};
int gestureCandidateSize = 0; // Current size of the live gesture data
int gestureCandidate[AXIS_COUNT][GESTURE_CANDIDATE_SIZE] = {
	{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
	{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
	{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }
};


int gestureSampleCount = 0;
int gestureSensorSampleCount = 0;
int gestureSignature[GESTURE_COUNT][AXIS_COUNT][GESTURE_SIGNATURE_MAXIMUM_SIZE] = {
	{
		{ -18, -17, -17, -17, -17, -17, -18, -18, -17, -17, -17, -18, -18, -18, -18, -17, -17, -17, -17, -17, -17, -17, -16, -16, -11, -8, -5, -5, -6, -2, -11, -2, -1, -2, 0 },
		{ -15, -15, -16, -16, -16, -17, -16, -16, -16, -15, -16, -15, -15, -14, -15, -15, -15, -15, -15, -14, -15, -15, -16, -16, -18, -18, -18, -17, -12, -21, -24, -33, -33, -28, -25 },
		{ 200, 200, 201, 202, 201, 201, 201, 200, 200, 199, 200, 200, 200, 199, 200, 201, 201, 201, 201, 201, 201, 201, 200, 200, 201, 201, 201, 202, 202, 201, 199, 199, 199, 201, 201 }
	},
	{
		{ 94, 94, 94, 91, 85, 76, 57, 31, -18, -85, -115, -144, -158, -136, -98, -79, -79, -86, -116, -102, -83, -69, -52, -37, -30, -19, -11, -9, -11, -43, -119, -151, -143, -207, -171 },
		{ -17, -15, -16, -15, -16, -18, -19, -21, -19, 0, 19, 38, 33, 30, 27, 14, 0, -3, -6, -14, -34, -31, -26, -17, -15, -9, -2, -6, -9, -5, 21, 27, 28, 20, 15 },
		{ 158, 157, 150, 145, 129, 97, 52, -25, -59, -21, 34, 195, 280, 312, 296, 240, 207, 231, 296, 355, 350, 329, 300, 280, 257, 229, 203, 166, 118, 96, 155, 143, 308, 374, 373 }
	},
	{
		{ -12, -12, -12, -12, -12, -10, -8, -6, -6, -7, -8, -13, -16, -19, -26, -31, -36, -34, -71, -43, -56, -43, -59, -54, -62, -58, -29, -22, -20, -11, -8, -6, -11, -11, -12 },
		{ 0, 4, 11, 18, 22, 23, 21, 14, 5, -5, -17, -35, -45, -55, -71, -81, -89, -91, -173, -106, -102, -119, -157, -151, -168, -89, -65, -41, -15, -9, -10, -13, -14, -21, -27 },
		{ 220, 224, 230, 235, 237, 234, 232, 224, 217, 212, 208, 204, 202, 202, 199, 196, 194, 194, 169, 164, 183, 223, 235, 221, 232, 223, 202, 195, 192, 196, 200, 202, 204, 210, 210 }
	},
	{
		{ -25, -25, -27, -26, -24, -24, -23, -23, -25, -27, -29, -31, -28, -30, -33, -35, -41, -43, -46, -17, -19, -19, -30, -67, 13, 19, 7, -3, -10, -10, -13, -17, -19, -21, -20 },
		{ 9, 2, -2, -5, -5, -1, 4, 12, 22, 29, 44, 70, 67, 64, 67, 70, 96, 118, 102, 77, 18, 53, 48, 89, -67, -66, -40, -39, -38, -32, -8, 9, 23, 32, 34 },
		{ 217, 221, 225, 226, 225, 223, 221, 220, 219, 219, 217, 200, 204, 209, 207, 216, 212, 208, 199, 202, 164, 208, 206, 194, 108, 158, 182, 199, 196, 199, 202, 206, 212, 212, 213 }
	},
	{
		{ -29, -36, -39, -45, -51, -58, -45, 26, 35, 0, -38, -10, -3, -67, -73, -138, -172, -171, -59, 30, 12, -12, -26, -10, 15, -35, -37, -82, -125, -94, -71, 2, -15, -75, -85 },
		{ -21, -20, -15, -22, -23, -23, -39, -21, 8, -20, -23, -25, -3, -25, -18, -15, -46, -69, -59, -16, -9, -3, -6, -15, 2, -4, -23, -30, -22, -23, -49, -34, -15, -22, -14 },
		{ 263, 292, 312, 300, 276, 281, 157, -20, 2, 12, 99, 157, 135, 200, 192, 221, 434, 377, 188, 48, 57, 44, 101, 197, 151, 211, 168, 183, 250, 253, 227, 160, 125, 199, 240 }
	},
	{
		{ 0, -1, -2, -1, -1, 0, 0, -1, -1, 0, 0, -1, -2, -2, -2, -1, -1, -1, -1, -3, -5, -5, -6, -3, -3, -5, -5, -4, -3, -2, -2, -2, -2, -1, -5 },
		{ -131, -135, -145, -147, -146, -145, -145, -146, -146, -149, -147, -150, -155, -156, -162, -168, -174, -180, -182, -184, -188, -191, -194, -195, -197, -198, -197, -193, -192, -201, -197, -195, -195, -171, -145 },
		{ 128, 125, 113, 110, 110, 110, 112, 111, 111, 111, 122, 123, 120, 117, 113, 109, 105, 95, 89, 84, 79, 73, 70, 65, 65, 64, 62, 65, 66, 55, 57, 58, 59, 85, 98 }
	},
	{
		{ -4, -4, -4, -4, -4, -3, -3, -3, -3, -3, -3, -3, -3, -2, -2, -5, -1, 0, -1, -1, -2, -2, -1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, -1, -1 },
		{ 52, 52, 52, 52, 52, 52, 51, 54, 56, 61, 67, 73, 82, 95, 104, 115, 123, 138, 147, 159, 165, 172, 178, 185, 190, 193, 195, 196, 197, 199, 203, 200, 201, 207, 208 },
		{ 170, 170, 171, 171, 171, 172, 174, 177, 178, 177, 175, 174, 170, 165, 158, 148, 143, 137, 132, 122, 116, 110, 104, 99, 97, 96, 88, 88, 83, 81, 74, 63, 62, 58, 57 }
	},
	{
		{ -111, -111, -112, -112, -112, -114, -118, -119, -123, -129, -131, -137, -146, -154, -164, -176, -184, -193, -198, -202, -209, -217, -220, -223, -226, -225, -227, -227, -228, -228, -230, -225, -225, -221, -220 },
		{ 5, 5, 6, 6, 7, 7, 8, 7, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 4, 5, 5, 6, 5, 5, 3, 2, 3, 4, 4, 4, 7, 12, 11, 25, 24 },
		{ 133, 133, 133, 134, 135, 136, 134, 135, 135, 135, 133, 130, 126, 123, 118, 112, 106, 94, 88, 83, 76, 68, 65, 62, 57, 50, 45, 44, 43, 42, 35, 41, 41, 35, 34 }
	},
	{
		{ 122, 123, 123, 126, 129, 129, 129, 132, 138, 146, 155, 158, 159, 160, 167, 180, 191, 197, 201, 206, 207, 210, 214, 214, 214, 216, 219, 223, 224, 222, 217, 208, 208, 184, 161 },
		{ -9, -8, -8, -8, -7, -7, -8, -9, -8, -8, -8, -9, -11, -12, -10, -9, -9, -11, -12, -9, -7, -5, -5, -5, -5, -5, -5, -5, -5, -8, -8, -6, -5, -16, -14 },
		{ 109, 110, 110, 110, 111, 113, 114, 115, 119, 120, 119, 113, 113, 106, 91, 82, 76, 74, 70, 59, 52, 45, 40, 37, 34, 33, 33, 31, 28, 31, 28, 29, 29, 46, 70 }
	}
};
